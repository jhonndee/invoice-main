{% extends "base.html" %}
{% block content %}

<div class="p-6 max-w-7xl mx-auto space-y-8">

    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold">
                Statistiques clients
            </h1>
            <p class="text-sm text-gray-500 mt-1">
                Analyse et répartition de votre base clients
            </p>
        </div>

        <a href="{% url 'dashboard' %}"
           class="px-4 py-2 rounded-lg border text-gray-600 hover:bg-gray-50">
            ← Retour au dashboard
        </a>
    </div>

    <!-- Grille des graphiques -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Clients par province -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
            <div class="mb-4">
                <h3 class="text-lg font-semibold">
                    Clients par province
                </h3>
                <p class="text-sm text-gray-500">
                    Répartition géographique des clients
                </p>
            </div>

            <div class="relative h-[320px]">
                <canvas id="clientsByProvinceChart"></canvas>
            </div>
        </div>

        <!-- Clients par tranche d'âge -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
            <div class="mb-4">
                <h3 class="text-lg font-semibold">
                    Clients par tranche d’âge
                </h3>
                <p class="text-sm text-gray-500">
                    Répartition démographique
                </p>
            </div>

            <div class="relative h-[320px]">
                <canvas id="clientsByAgeRangeChart"></canvas>
            </div>
        </div>

        <!-- Clients par mois -->
        <div class="bg-white rounded-xl shadow-sm border p-6 lg:col-span-2">
            <div class="mb-4">
                <h3 class="text-lg font-semibold">
                    Évolution mensuelle des clients
                </h3>
                <p class="text-sm text-gray-500">
                    Nombre de nouveaux clients par mois
                </p>
            </div>

            <div class="relative h-[320px]">
                <canvas id="clientsByMonthChart"></canvas>
            </div>
        </div>

    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<script>
const commonOptions = {
    plugins: {
        datalabels: {
            color: '#334155',
            anchor: 'end',
            align: 'top',
            font: { weight: 'bold', size: 11 }
        }
    },
    responsive: true,
    maintainAspectRatio: false,
    scales: { y: { beginAtZero: true } }
};

// Clients par province
new Chart(document.getElementById('clientsByProvinceChart'), {
    type: 'bar',
    data: {
        labels: {{ clients_by_province_labels|safe }},
        datasets: [{
            label: 'Clients',
            data: {{ clients_by_province_data|safe }},
            backgroundColor: 'rgba(37, 99, 235, 0.7)',
            borderRadius: 6
        }]
    },
    options: commonOptions,
    plugins: [ChartDataLabels]
});

// Clients par tranche d'âge
new Chart(document.getElementById('clientsByAgeRangeChart'), {
    type: 'pie',
    data: {
        labels: {{ clients_by_age_labels|safe }},
        datasets: [{
            data: {{ clients_by_age_data|safe }},
            backgroundColor: [
                '#2563eb',
                '#22c55e',
                '#f59e0b',
                '#ef4444',
                '#8b5cf6'
            ]
        }]
    },
    options: {
        plugins: {
            datalabels: {
                color: '#fff',
                font: { weight: 'bold' }
            }
        }
    },
    plugins: [ChartDataLabels]
});

// Clients par mois
new Chart(document.getElementById('clientsByMonthChart'), {
    type: 'line',
    data: {
        labels: {{ clients_by_month_labels|safe }},
        datasets: [{
            label: 'Clients',
            data: {{ clients_by_month_data|safe }},
            borderColor: '#22c55e',
            backgroundColor: 'rgba(34, 197, 94, 0.15)',
            fill: true,
            tension: 0.35
        }]
    },
    options: commonOptions,
    plugins: [ChartDataLabels]
});
</script>

{% endblock %}
